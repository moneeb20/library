<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>Ø§Ù„ÙƒØªØ¨ - Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©</title>
  <link rel="stylesheet" href="../static/css/style.css">
</head>
<body>
  <header><h1>Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ù…ØªÙˆÙØ±Ø© ÙÙŠ Ø§Ù„Ù…ÙƒØªØ¨Ø©</h1>
  <style>
.flash-messages {
  margin: 20px auto;
  padding: 10px;
  width: 90%;
  max-width: 600px;
}
.alert {
  padding: 10px;
  border-radius: 8px;
  margin-bottom: 10px;
  text-align: center;
}
.alert-success { background-color: #d4edda; color: #155724; }
.alert-error { background-color: #f8d7da; color: #721c24; }
.alert-info { background-color: #d1ecf1; color: #0c5460; }
</style>
  </header>

  <nav>
    <a href="{{ url_for('index') }}">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
      <a href="{{ url_for('books') }}">Ø§Ù„ÙƒØªØ¨</a>
      <a href="{{ url_for('login') }}">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
      <a href="{{ url_for('support') }}" >Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ</a>
      <a href="{{ url_for('moder') }}" id="moderLink">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
      <a href="{{ url_for('profile') }}">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</a>
  </nav>
  {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ category }}">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}
  <div class="search-bar">
    <form action="{{ url_for('books') }}" method="get">
        <input type="text" name="title" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„ÙƒØªØ§Ø¨" value="{{ search_title }}">
        <input type="text" name="author" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ù…Ø¤Ù„Ù" value="{{ search_author }}">
        <select name="category">
            <option value="">ÙƒÙ„ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</option>
            {% for cat in categories %}
                <option value="{{ cat.id }}" 
                    {% if selected_category == cat.id|string %}selected{% endif %}>
                    {{ cat.name }}
                </option>
            {% endfor %}
        </select>
        <button type="submit" class="btn btnsearch">Ø¨Ø­Ø«</button>
    </form>
</div>

  <div class="container">
    {% for book in books %}
    <div class="book">
<img src="{{ url_for('static', filename='img/' + book.cover_image) }}" alt="{{ book.title }}">      <div class="book-content">
        <h3 class="title">{{ book.title }} <span class="favorite" onclick="toggleFavorite(this)">â™¡</span></h3>
        <p>Ø§Ù„Ù…Ø¤Ù„Ù: {{ book.author }}</p>
        <p>Ø§Ù„ØªØµÙ†ÙŠÙ: {{ book.category }}</p>
        <span class="label">{{ book.book_type }}</span>
       {% if book.price == 0 %}
    <a href="{{ url_for('static', filename='books/' + book.digital_file) }}" class="btn-download" download>ØªØ­Ù…ÙŠÙ„</a>
{% elif 'user_id' in session and book.book_id in purchased_book_ids %}
    <a href="{{ url_for('static', filename='books/' + book.digital_file) }}" class="btn-download" download>ØªØ­Ù…ÙŠÙ„</a>
{% elif 'user_id' in session %}
    <form method="post" action="{{ url_for('buy_book', book_id=book.book_id) }}">
        <button type="submit" class="btn-buy" onclick="alert('ØªÙ… Ø§Ù„Ø´Ø±Ø§Ø¡ Ø¨Ù†Ø¬Ø§Ø­')">Ø´Ø±Ø§Ø¡ {{ book.price }} Ù„.Ø³</button>
    </form>
{% else %}
    <a href="{{ url_for('login') }}" class="btn-buy">
      Ø³Ø¬Ù‘Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø¯ÙØ¹
    </a>
{% endif %}
        <div class="description-popup">{{ book.description }}</div>
        <button class="toggle-description-btn" onclick="toggleFullDescription(this)">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯</button>
      </div>
    </div>
    {% endfor %}
  </div>
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="flash-messages">
      {% for category, message in messages %}
        <div class="alert alert-{{ category }}">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}
  <footer>&copy; 2025 Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© - Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©</footer>
  <script src="../static/js/script.js"></script>
 <script>
  document.addEventListener("DOMContentLoaded", function () {
    const moderLink = document.getElementById("moderLink");

    if (moderLink) {
      moderLink.addEventListener("click", function (e) {
        e.preventDefault();  // Ù…Ù†Ø¹ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„

        // Ø¬Ù„Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ø§Ù„Ø¬Ù„Ø³Ø© (ØªÙ…Ø±ÙŠØ± Ù…Ù† Ø¨Ø§ÙŠØ«ÙˆÙ† Ø¥Ù„Ù‰ HTML)
        const userType = "{{ session.get('user_type', 'guest') }}";

        if (userType === "admin" || userType === "moderator") {
          window.location.href = "/moder";
        } else {
          showAlert("ğŸš« Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ§Øª Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ….");
        }
      });
    }

    function showAlert(message) {
      const existing = document.getElementById("customAlert");
      if (existing) existing.remove();

      const alertBox = document.createElement("div");
      alertBox.id = "customAlert";
      alertBox.innerHTML = message;
      alertBox.style.cssText = `
        background-color: #ffdddd;
        color: #a94442;
        padding: 15px;
        margin: 20px;
        border: 1px solid #f5c6cb;
        border-radius: 5px;
        text-align: center;
        font-weight: bold;
      `;
      document.body.prepend(alertBox);

      setTimeout(() => {
        alertBox.remove();
      }, 4000);
    }
  });
</script>
</body>
</html>


