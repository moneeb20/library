<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styleprofile.css') }}">
  <title>ุงูููู ุงูุดุฎุตู</title>
</head>
<body>

  <header>
    <h1>ุงูููู ุงูุดุฎุตู</h1>
  </header>

  <nav>
    <a href="{{ url_for('index') }}">ุงูุฑุฆูุณูุฉ</a>
    <a href="{{ url_for('books') }}">ุงููุชุจ</a>
    <a href="{{ url_for('support') }}">ุงูุฏุนู ุงูููู</a>
    <a href="{{ url_for('moder') }}" id="moderlink">ููุญุฉ ุงูุชุญูู</a>
    <a href="{{ url_for('profile') }}">ุงูููู ุงูุดุฎุตู</a>
  </nav>
  {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ category }}">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}

  <div class="profile-container">
    <div class="profile-info">
      <h2>ูุฑุญุจุงูุ {{ name }}</h2>
      <p><span class="highlight">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู:</span> {{ email }}</p>
      
      <p><span class="highlight">ุนุฏุฏ ุงููุชุจ ุงููุฌุงููุฉ:</span> {{ free_books | length }}</p>
      {% if free_books %}
        <ul>
          {% for book in free_books %}
  <li>
    <a href="{{ url_for('static', filename='books/' + book.digital_file) }}" download>{{ book.title }}</a>
  </li>
{% endfor %}

{% for book in paid_books %}
  <li>
    <a href="{{ url_for('static', filename='books/' + book.digital_file) }}" download>{{ book.title }}</a>
  </li>
{% endfor %}
        </ul>
      {% else %}
        <p>ูุง ุชูุฌุฏ ูุชุจ ูุฏููุนุฉ.</p>
      {% endif %}

      <div class="separator"></div>
    </div>

    <div class="options">
      <button class="btn" onclick="showEditPopup()">ุชุนุฏูู ุงููุนูููุงุช</button>
      <button class="btn" onclick="showPasswordPopup()">ุชุบููุฑ ูููุฉ ุงููุฑูุฑ</button>
      <button class="btn" onclick="showLogoutPopup()">ุชุณุฌูู ุงูุฎุฑูุฌ</button>
    </div>
  </div>

  <footer>
    &copy; 2025 ุฌููุน ุงูุญููู ูุญููุธุฉ - ุงูููุชุจุฉ ุงูุฅููุชุฑูููุฉ
  </footer>

  <!-- ุงูููุงูุฐ ุงูููุจุซูุฉ -->
  <div class="popup-overlay" id="popup">
    <div class="popup-box">
      <p>ูู ุฃูุช ูุชุฃูุฏ ุฃูู ุชุฑูุฏ ุชุณุฌูู ุงูุฎุฑูุฌุ</p>
      <button class="btn" onclick="logout()">ูุนูุ ุชุณุฌูู ุงูุฎุฑูุฌ</button>
      <button class="btn" onclick="hideLogoutPopup()">ุฅูุบุงุก</button>
    </div>
  </div>

  <div class="popup-overlay" id="editPopup">
    <div class="popup-box">
      <p>ุณูุชู ุชุญูููู ุฅูู ุตูุญุฉ ุชุนุฏูู ุงููุนูููุงุช ูุงุญูุงู</p>
      <button class="btn" onclick="hideEditPopup()">ุญุณูุงู</button>
    </div>
  </div>

  <div class="popup-overlay" id="passwordPopup">
    <div class="popup-box">
      <p>ุณูุชู ุชุญูููู ุฅูู ุตูุญุฉ ุชุบููุฑ ูููุฉ ุงููุฑูุฑ ูุงุญูุงู</p>
      <button class="btn" onclick="hidePasswordPopup()">ุญุณูุงู</button>
    </div>
  </div>

  <script>
    function showLogoutPopup() {
      document.getElementById("popup").style.display = "flex";
    }

    function hideLogoutPopup() {
      document.getElementById("popup").style.display = "none";
    }

    function logout() {
      window.location.href = "{{ url_for('logout') }}";
    }

    function showEditPopup() {
      document.getElementById("editPopup").style.display = "flex";
    }

    function hideEditPopup() {
      document.getElementById("editPopup").style.display = "none";
    }

    function showPasswordPopup() {
      document.getElementById("passwordPopup").style.display = "flex";
    }

    function hidePasswordPopup() {
      document.getElementById("passwordPopup").style.display = "none";
    }
  </script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const moderLink = document.getElementById("moderLink");

    if (moderLink) {
      moderLink.addEventListener("click", function (e) {
        e.preventDefault();  // ููุน ุงูุงูุชูุงู

        // ุฌูุจ ููุน ุงููุณุชุฎุฏู ูู ุงูุฌูุณุฉ (ุชูุฑูุฑ ูู ุจุงูุซูู ุฅูู HTML)
        const userType = "{{ session.get('user_type', 'guest') }}";

        if (userType === "admin" || userType === "moderator") {
          window.location.href = "/moder";
        } else {
          showAlert("๐ซ ููุณ ูุฏูู ุตูุงุญูุงุช ูููุตูู ุฅูู ููุญุฉ ุงูุชุญูู.");
        }
      });
    }

    function showAlert(message) {
      const existing = document.getElementById("customAlert");
      if (existing) existing.remove();

      const alertBox = document.createElement("div");
      alertBox.id = "customAlert";
      alertBox.innerHTML = message;
      alertBox.style.cssText = `
        background-color: #ffdddd;
        color: #a94442;
        padding: 15px;
        margin: 20px;
        border: 1px solid #f5c6cb;
        border-radius: 5px;
        text-align: center;
        font-weight: bold;
      `;
      document.body.prepend(alertBox);

      setTimeout(() => {
        alertBox.remove();
      }, 4000);
    }
  });
</script>
</body>
</html>